var R=(w,a,u)=>new Promise((c,b)=>{var k=o=>{try{_(u.next(o))}catch(s){b(s)}},h=o=>{try{_(u.throw(o))}catch(s){b(s)}},_=o=>o.done?c(o.value):Promise.resolve(o.value).then(k,h);_((u=u.apply(w,a)).next())});import{b1 as q,aS as n,b2 as M,b3 as A,a_ as V,aT as U,b4 as F,aU as S,b5 as N,ay as Q,b6 as j,a$ as I}from"./bootstrap-BYMVwl9-.js";import{T as x}from"./auth-title-CE0BdyLK.js";import{u as D,R as K,M as G,a as z,b as J,c as O}from"./use-modal-CqQluUHm.js";import{a4 as T,av as L,ab as r,x as l,ac as d,a7 as e,aB as f,bI as W,aj as m,aa as v,aq as g,T as Y,J as E,P as H,a9 as X,a8 as C,ai as y,aV as Z}from"../jse/index-index-BuhP3T1S.js";import{v as ee}from"./AlertBuilder-BEh17U8H.js";import"./index-ClXbwVrE.js";import"./x-DJz92f4i.js";import"./circle-check-big-DafNGcJI.js";const te=T({__name:"dingding-login",props:{clientId:{},corpId:{},redirectUri:{},isQrCode:{type:Boolean}},setup(w){const a=w,u=q(),[c,b]=D({header:!1,footer:!1,fullscreenButton:!1,class:"w-[302px] h-[302px] dingding-qrcode-login-modal",onOpened(){h()}}),k=()=>{const{redirectUri:o}=a;return o||window.location.origin+u.fullPath},h=()=>R(null,null,function*(){const{clientId:o,corpId:s}=a;window.DTFrameLogin||(yield W("https://g.alicdn.com/dingding/h5-dingtalk-login/0.21.0/ddlogin.js")),window.DTFrameLogin({id:"dingding_qrcode_login_element",width:300,height:300},{redirect_uri:encodeURIComponent(k()),client_id:o,scope:"openid corpid",response_type:"code",state:"1",prompt:"consent",corpId:s},p=>{const{redirectUrl:P}=p;window.location.href=P},p=>{ee(`Login Error: ${p}`)})}),_=()=>{const{clientId:o,corpId:s,isQrCode:p}=a;p?b.open():window.location.href=`https://login.dingtalk.com/oauth2/auth?redirect_uri=${encodeURIComponent(k())}&response_type=code&client_id=${o}&scope=openid&corpid=${s}&prompt=consent`};return(o,s)=>(r(),L("div",null,[l(e(M),{onClick:_,tooltip:e(n)("authentication.dingdingLogin"),"tooltip-side":"top"},{default:d(()=>[l(e(K))]),_:1},8,["tooltip"]),l(e(c),null,{default:d(()=>s[0]||(s[0]=[f("div",{id:"dingding_qrcode_login_element"},null,-1)])),_:1,__:[0]})]))}}),oe={class:"w-full sm:mx-auto md:max-w-md"},ne={class:"mt-4 flex items-center justify-between"},ie={class:"text-muted-foreground text-center text-xs uppercase"},ae={class:"mt-4 flex flex-wrap justify-center"},se=T({name:"ThirdPartyLogin",__name:"third-party-login",setup(w){const{auth:{dingding:a}}=A();return(u,c)=>(r(),L("div",oe,[f("div",ne,[c[0]||(c[0]=f("span",{class:"border-input w-[35%] border-b dark:border-gray-600"},null,-1)),f("span",ie,m(e(n)("authentication.thirdPartyLogin")),1),c[1]||(c[1]=f("span",{class:"border-input w-[35%] border-b dark:border-gray-600"},null,-1))]),f("div",ae,[l(e(M),{tooltip:e(n)("authentication.wechatLogin"),"tooltip-side":"top",class:"mb-3"},{default:d(()=>[l(e(G))]),_:1},8,["tooltip"]),l(e(M),{tooltip:e(n)("authentication.qqLogin"),"tooltip-side":"top",class:"mb-3"},{default:d(()=>[l(e(z))]),_:1},8,["tooltip"]),l(e(M),{tooltip:e(n)("authentication.githubLogin"),"tooltip-side":"top",class:"mb-3"},{default:d(()=>[l(e(J))]),_:1},8,["tooltip"]),l(e(M),{tooltip:e(n)("authentication.googleLogin"),"tooltip-side":"top",class:"mb-3"},{default:d(()=>[l(e(O))]),_:1},8,["tooltip"]),e(a)?(r(),v(te,{key:0,"corp-id":e(a).corpId,"client-id":e(a).clientId,class:"mb-3"},null,8,["corp-id","client-id"])):g("",!0)])]))}}),le=["onKeydown"],re={class:"text-muted-foreground"},de={key:0,class:"mb-6 flex justify-between"},ue={class:"flex-center"},ce={key:1,class:"mb-2 mt-4 flex items-center justify-between"},me={key:0,class:"mt-3 text-center text-sm"},pe=T({name:"AuthenticationLogin",__name:"login",props:{formSchema:{default:()=>[]},codeLoginPath:{default:"/auth/code-login"},forgetPasswordPath:{default:"/auth/forget-password"},loading:{type:Boolean,default:!1},qrCodeLoginPath:{default:"/auth/qrcode-login"},registerPath:{default:"/auth/register"},showCodeLogin:{type:Boolean,default:!1},showForgetPassword:{type:Boolean,default:!1},showQrcodeLogin:{type:Boolean,default:!1},showRegister:{type:Boolean,default:!1},showRememberMe:{type:Boolean,default:!1},showThirdPartyLogin:{type:Boolean,default:!1},subTitle:{default:""},title:{default:""},submitButtonText:{default:""}},emits:["submit"],setup(w,{expose:a,emit:u}){const c=w,b=u,[k,h]=V(Y({commonConfig:{hideLabel:!1,hideRequiredMark:!0,colon:!0},schema:E(()=>c.formSchema),showDefaultActions:!1})),_=U(),o=`REMEMBER_ME_USERNAME_${location.hostname}`,s=localStorage.getItem(o)||"",p=H(!!s);function P(){return R(this,null,function*(){const{valid:t}=yield h.validate(),i=yield h.getValues();t&&(localStorage.setItem(o,p.value?i==null?void 0:i.username:""),b("submit",i))})}function B(t){_.push(t)}return X(()=>{s&&h.setFieldValue("username",s)}),a({getFormApi:()=>h}),(t,i)=>(r(),L("div",{onKeydown:N(Q(P,["prevent"]),["enter"])},[C(t.$slots,"title",{},()=>[l(x,null,{desc:d(()=>[f("span",re,[C(t.$slots,"subTitle",{},()=>[y(m(t.subTitle||e(n)("authentication.loginSubtitle")),1)])])]),default:d(()=>[C(t.$slots,"title",{},()=>[y(m(t.title||`${e(n)("authentication.welcomeBack")}`),1)])]),_:3})]),l(e(k)),t.showRememberMe||t.showForgetPassword?(r(),L("div",de,[f("div",ue,[t.showRememberMe?(r(),v(e(F),{key:0,checked:p.value,"onUpdate:checked":i[0]||(i[0]=$=>p.value=$),name:"rememberMe"},{default:d(()=>[y(m(e(n)("authentication.rememberMe")),1)]),_:1},8,["checked"])):g("",!0)]),t.showForgetPassword?(r(),L("span",{key:0,class:"vben-link text-sm font-normal",onClick:i[1]||(i[1]=$=>B(t.forgetPasswordPath))},m(e(n)("authentication.forgetPassword")),1)):g("",!0)])):g("",!0),l(e(S),{class:Z([{"cursor-wait":t.loading},"w-full"]),loading:t.loading,"aria-label":"login",onClick:P},{default:d(()=>[y(m(t.submitButtonText||e(n)("common.login")),1)]),_:1},8,["class","loading"]),t.showCodeLogin||t.showQrcodeLogin?(r(),L("div",ce,[t.showCodeLogin?(r(),v(e(S),{key:0,class:"w-1/2",variant:"outline",onClick:i[2]||(i[2]=$=>B(t.codeLoginPath))},{default:d(()=>[y(m(e(n)("authentication.mobileLogin")),1)]),_:1})):g("",!0),t.showQrcodeLogin?(r(),v(e(S),{key:1,class:"ml-4 w-1/2",variant:"outline",onClick:i[3]||(i[3]=$=>B(t.qrCodeLoginPath))},{default:d(()=>[y(m(e(n)("authentication.qrcodeLogin")),1)]),_:1})):g("",!0)])):g("",!0),C(t.$slots,"third-party-login",{},()=>[t.showThirdPartyLogin?(r(),v(se,{key:0})):g("",!0)]),C(t.$slots,"to-register",{},()=>[t.showRegister?(r(),L("div",me,[y(m(e(n)("authentication.accountTip"))+" ",1),f("span",{class:"vben-link text-sm font-normal",onClick:i[4]||(i[4]=$=>B(t.registerPath))},m(e(n)("authentication.createAccount")),1)])):g("",!0)])],40,le))}}),ve=T({name:"Login",__name:"login",setup(w){const a=j(),u=E(()=>[{component:"VbenInput",fieldName:"name",label:"用户名",rules:I().min(1,{message:n("authentication.usernameTip")})},{component:"VbenInput",fieldName:"password",label:"密码",rules:I().min(1,{message:n("authentication.passwordTip")})}]);return(c,b)=>(r(),v(e(pe),{"form-schema":u.value,loading:e(a).loginLoading,onSubmit:e(a).authLogin},null,8,["form-schema","loading","onSubmit"]))}});export{ve as default};
